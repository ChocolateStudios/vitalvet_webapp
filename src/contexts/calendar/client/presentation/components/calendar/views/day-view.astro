---
import type { EventListItemInfo } from "@/contexts/calendar/server/application/usecases/getall-events.usecase";

const { data } = Astro.props;
const { selectedDate, events } = data;

const day = new Date(selectedDate);
const dateString = day.toISOString().split('T')[0];
const dayEvents = events.filter((e: EventListItemInfo) => e.startDateTime.toISOString().split('T')[0] === dateString);

const timeSlots = Array.from({ length: 24 }, (_, i) => `${i}:00`); // 8am to 8pm
---

<div class="border rounded-lg">
    <div class="grid grid-cols-[auto_1fr]">
        <!-- Eje de Tiempo -->
        <div class="col-start-1 row-start-2 border-r">
            {timeSlots.map(time => (
                <div class="h-16 text-right pr-2 text-xs text-gray-500 border-t">{time}</div>
            ))}
        </div>

        <!-- Cuadrícula del Día -->
        <div class="col-start-2 row-start-2">
            <div class="border-l">
                {timeSlots.map((time, index) => (
                    <div class="h-16 border-t"></div>
                ))}
            </div>
        </div>

        <!-- Encabezado del Día -->
        <div class="col-start-2 row-start-1 text-center font-semibold text-sm sticky top-0 bg-white z-10 shadow-sm">
            <div class="py-2 border-l">
                <div>{new Intl.DateTimeFormat('es-ES', { weekday: 'long' }).format(day)}</div>
                <div class="text-lg">{day.getDate()}</div>
            </div>
        </div>

        <!-- Contenedor de Eventos -->
        <div class="col-start-2 row-start-2 relative">
            <div class="relative">
                {dayEvents.map((event: EventListItemInfo) => {
                    const startHour = event.startDateTime.getHours();
                    const duration = 1; // Asumimos 1 hora de duración
                    const top = (startHour) * 4; // 4rem (h-16) por hora, desde las 8am
                    const height = duration * 4;
                    return (
                        <div
                            class="absolute w-full p-1"
                            style={{ top: `${top}rem`, height: `${height}rem` }}
                        >
                            <a href={`/app/calendar/events/${event.id}`} class="bg-blue-200 text-blue-900 text-xs rounded-lg p-1 h-full overflow-hidden block cursor-pointer">
                                {event.title}
                            </a>
                        </div>
                    )
                })}
            </div>
        </div>
    </div>
</div>
