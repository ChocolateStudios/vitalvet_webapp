---
import { getAllEvents } from "@/contexts/calendar/server/application/usecases/getall-events.usecase"
import CalendarComponent from "@/contexts/calendar/client/presentation/components/calendar/calendar.component.astro";
import SearchBar from "@/contexts/_shared/client/presentation/components/search-bar.component.astro";
import ContentTop from "@/contexts/_shared/client/presentation/components/content/content-top.component.astro";
import ActionLink from "@/contexts/_shared/client/presentation/components/actions/action-link.component.astro";
import ContentContainer from "@/contexts/_shared/client/presentation/components/content/content-container.component.astro";

let events: any[] = [];
const today = new Date();

const getEventsResult = await getAllEvents();
if (getEventsResult.success) {
    events = getEventsResult.data ?? [];
}

const data = {
    selectedDate: today,
    events: events,
};
---

<ContentContainer>
    <ContentTop>
        Calendario <!-- MainTitle -->
        <div slot="right" class="flex gap-4">
            <SearchBar id="calendar-search" name="calendar-search" />
            <ActionLink href={`/app/calendar/events/new`} style="submit">
                AÃ±adir evento
            </ActionLink>
        </div>
    </ContentTop>
    <CalendarComponent {data} />
</ContentContainer>